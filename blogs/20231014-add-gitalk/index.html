<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="1. 增加模板页在主题的目录下 themes/xxx/layouts/partials/gitalk.html 1{{ if .Site.Params.enableGitalk }} 2&lt;div id=&#34;gitalk-container&#34;&gt;&lt;/div&gt; 3&lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/gitalk/dist/gitalk.css&#34;&gt; 4&lt;script src=&#34;https://unpkg.com/gitalk/dist/gitalk.min.js&#34;&gt;&lt;/script&gt; 5&lt;script&gt; 6 const gitalk = new Gitalk({ 7 clientID: &#39;{{ .Site.Params.Gitalk.clientID }}&#39;, 8 clientSecret: &#39;{{ .Site.Params.Gitalk.clientSecret }}&#39;, 9 repo: &#39;{{ .Site.Params.Gitalk.repo }}&#39;, 10 owner: &#39;{{ .Site.Params.Gitalk.owner }}&#39;, 11 admin: [&#39;{{ .Site.Params.Gitalk.owner }}&#39;], 12 id: location.pathname, // Ensure uniqueness and length less than 50 13 distractionFreeMode: false // Facebook-like distraction free mode 14 }); 15 (function () { 16 if ([&#34;localhost&#34;, &#34;127.">  

  <title>
    
      Add Gitalk 评论组件
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  
  
  
  <link rel="stylesheet" href="/css/main.b9037e15522b97f32270bef9e19aca126b5687b36d81b54a254afa9710b28316bf348995b1bcff58a4dab146a517cbe81bede7f5baf4d6003036371ffb3f209e.css" integrity="sha512-uQN&#43;FVIrl/MicL754ZrKEmtWh7NtgbVKJUr6lxCygxa/NImVsbz/WKTasUalF8voG&#43;3n9br01gAwNjcf&#43;z8gng==" />
  
</head>
<body a="light">
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">.. back to home</a>


<article>
    <p class="post-meta">
        <time datetime="2023-10-14 22:51:48 &#43;0800 &#43;0800">
            2023-10-14
        </time>
    </p>

    <h1>Add Gitalk 评论组件</h1>

    

    
    
    <aside >
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1-增加模板页在主题的目录下-themesxxxlayoutspartialsgitalkhtml">1. 增加模板页在主题的目录下 <code>themes/xxx/layouts/partials/gitalk.html</code></a></li>
    <li><a href="#2配置参数-configtoml">2.配置参数 <code>config.toml</code></a></li>
    <li><a href="#3-申请gitalk信息">3. 申请<code>gitalk</code>信息</a>
      <ul>
        <li><a href="#有个问题这样直接填不就都暴露了嘛">有个问题，这样直接填不就都暴露了嘛？？</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </aside>
    
    
    <hr class="hr-common"> 

    <h2 id="1-增加模板页在主题的目录下-themesxxxlayoutspartialsgitalkhtml">1. 增加模板页在主题的目录下 <code>themes/xxx/layouts/partials/gitalk.html</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>{{ if .Site.Params.enableGitalk }}
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;gitalk-container&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>&lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;stylesheet&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;https://unpkg.com/gitalk/dist/gitalk.css&#34;</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;https://unpkg.com/gitalk/dist/gitalk.min.js&#34;</span>&gt;&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>&lt;<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>  <span style="color:#000;font-weight:bold">const</span> gitalk <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Gitalk({
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    clientID<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;{{ .Site.Params.Gitalk.clientID }}&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    clientSecret<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;{{ .Site.Params.Gitalk.clientSecret }}&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    repo<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;{{ .Site.Params.Gitalk.repo }}&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    owner<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    admin<span style="color:#000;font-weight:bold">:</span> [<span style="color:#d14">&#39;{{ .Site.Params.Gitalk.owner }}&#39;</span>],
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    id<span style="color:#000;font-weight:bold">:</span> location.pathname, <span style="color:#998;font-style:italic">// Ensure uniqueness and length less than 50
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span><span style="color:#998;font-style:italic"></span>    distractionFreeMode<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">false</span> <span style="color:#998;font-style:italic">// Facebook-like distraction free mode
</span></span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span><span style="color:#998;font-style:italic"></span>  });
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>  (<span style="color:#000;font-weight:bold">function</span> () {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    <span style="color:#000;font-weight:bold">if</span> ([<span style="color:#d14">&#34;localhost&#34;</span>, <span style="color:#d14">&#34;127.0.0.1&#34;</span>].indexOf(<span style="color:#0086b3">window</span>.location.hostname) <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">-</span><span style="color:#099">1</span>) {
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>      <span style="color:#0086b3">document</span>.getElementById(<span style="color:#d14">&#39;gitalk-container&#39;</span>).innerHTML <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#39;Gitalk comments not available by default when the website is previewed locally.&#39;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>      <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    gitalk.render(<span style="color:#d14">&#39;gitalk-container&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>  })();
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>{{ end }}
</span></span></code></pre></div><p>其中有一些参数</p>
<h2 id="2配置参数-configtoml">2.配置参数 <code>config.toml</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>[params]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>  enableGitalk = <span style="color:#000;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>  [params.theme_config]
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    appearance = <span style="color:#d14">&#34;light&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    back_home_text = <span style="color:#d14">&#34;..&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    date_format = <span style="color:#d14">&#34;2006-01-02&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  [params.gitalk] 
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    clientID = <span style="color:#d14">&#34;QQQQQQQQQQQQQQQQ&#34;</span> <span style="color:#998;font-style:italic"># 您刚才创建Github Application 的 Client ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    clientSecret = <span style="color:#d14">&#34;QQQQQQQQQQQQQQQQ&#34;</span> <span style="color:#998;font-style:italic"># 您刚才创建Github Application 的 Client Secret</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    repo = <span style="color:#d14">&#34;livebug.github.io&#34;</span> <span style="color:#998;font-style:italic"># 您的博客的github地址Repository name，例如：xxxx.github.io</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    owner = <span style="color:#d14">&#34;livebug&#34;</span> <span style="color:#998;font-style:italic"># 您的GitHub ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    admin= <span style="color:#d14">&#34;livebug&#34;</span> <span style="color:#998;font-style:italic"># 您的GitHub ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    id= <span style="color:#d14">&#34;location.pathname&#34;</span> <span style="color:#998;font-style:italic"># 文章页面的链接地址就是ID</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    labels= <span style="color:#d14">&#34;gitalk&#34;</span> <span style="color:#998;font-style:italic"># Github issue labels. If you used to use Gitment, you can change it</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    perPage= <span style="color:#099">15</span> <span style="color:#998;font-style:italic"># Pagination size, with maximum 100.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>    pagerDirection= <span style="color:#d14">&#34;last&#34;</span> <span style="color:#998;font-style:italic"># Comment sorting direction, available values are &#39;last&#39; and &#39;first&#39;.</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>    createIssueManually= <span style="color:#000;font-weight:bold">true</span> <span style="color:#998;font-style:italic"># 设置为true，如果是管理员登录，会自动创建issue，如果是false，需要管理员手动添加第一个评论(issue)</span>
</span></span><span style="display:flex;"><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    distractionFreeMode= <span style="color:#000;font-weight:bold">false</span> <span style="color:#998;font-style:italic"># Enable hot key (cmd|ctrl + enter) submit comment.</span>
</span></span></code></pre></div><p>其中有一些 <code>gitalk</code> 的基础信息，需要申请配置下</p>
<h2 id="3-申请gitalk信息">3. 申请<code>gitalk</code>信息</h2>
<p>首先创建一个<code>OAuth application</code>应用，地址 <a href="https://github.com/settings/applications/new">https://github.com/settings/applications/new</a></p>
<p><img src="/img/20201216163446137.png" alt="">
申请之后，选择<code>Generate a new client secret</code>
<img src="/img/2023-10-14-225937.png" alt=""></p>
<p>把 <code>clientID</code> 和 <code>clientSecret</code> 填到配置中</p>
<h3 id="有个问题这样直接填不就都暴露了嘛">有个问题，这样直接填不就都暴露了嘛？？</h3>
<p><a href="https://github.com/gitalk/gitalk/issues/150#issuecomment-402366588">https://github.com/gitalk/gitalk/issues/150#issuecomment-402366588</a></p>
<p>这里给了回答</p>
<blockquote>
<p>获取或修改 GitHub 用户数据，需要 token，为了拿到 token，除了需要 OAuth App 的 client_id 和 client_secret 外，还需要一个 Authorization Code。 <br>
这个 code 是 GitHub 登录授权完成时，在跳转回 redirect_uri 的查询参数拿到的， redirect_uri 必须是在 OAuth App 配置的 callback URL 域名下。<br>
这样即使别人用了你的 client_id 和 client_secret ，跳转之后也拿不到 code，所以，有 client_id 和 client_secret 也做不了什么。</p>
</blockquote>

</article>
<hr class="hr-common">

<footer class="post-footer">
    <ul class="post-tags">
        <li><a href="https://livebug.github.io/tags/hugo/">hugo</a></li>
        <li><a href="https://livebug.github.io/tags/gitalk/">gitalk</a></li>
    </ul>

    
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script>
  const gitalk = new Gitalk({
    clientID: '611a6636d92469d23028',
    clientSecret: 'e33f7c182796cd46d35977af0c04dcf1cb16b49f',
    repo: 'livebug.github.io',
    owner: 'livebug',
    admin: ['livebug'],
    id: location.pathname, 
    distractionFreeMode: false 
  });
  (function () {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>


</footer>


            </div>
        </main>
    </body></html>
